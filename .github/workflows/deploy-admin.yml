name: Deploy Admin Panel to Firebase Hosting

on:
  push:
    branches:
      - main
  workflow_dispatch:

jobs:
  build-and-deploy:
    runs-on: ubuntu-latest
    
    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '20'
          cache: 'npm'
          cache-dependency-path: package-lock.json

      - name: Install dependencies
        run: npm ci

      - name: Create .env file
        run: |
          cat << EOF > .env
          VITE_API_BASE_URL=https://graphosai-admin-472729326429.us-central1.run.app
          VITE_API_TIMEOUT=30000
          VITE_FIREBASE_API_KEY=AIzaSyAhHsXuRUsUfQjsVqlu6F7uix_E9zFTXm4
          VITE_FIREBASE_AUTH_DOMAIN=notes-sync-472107.firebaseapp.com
          VITE_FIREBASE_PROJECT_ID=notes-sync-472107
          VITE_FIREBASE_STORAGE_BUCKET=notes-sync-472107.firebasestorage.app
          VITE_FIREBASE_MESSAGING_SENDER_ID=472729326429
          VITE_FIREBASE_APP_ID=1:472729326429:web:8f3d06edfde82426820eb4
          VITE_ENABLE_ANALYTICS=true
          VITE_ENABLE_REALTIME=true
          VITE_APP_ENV=production
          EOF

      - name: Build
        run: npm run build

      - name: Deploy to Firebase Hosting
        uses: FirebaseExtended/action-hosting-deploy@v0
        with:
          repoToken: ${{ secrets.GITHUB_TOKEN }}
          firebaseServiceAccount: ${{ secrets.FIREBASE_SERVICE_ACCOUNT }}
          channelId: live
          projectId: notes-sync-472107
